<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XINNIX Mission Statement Builder</title>
  <style>
    :root{
      --brand:#003366; --accent:#2bb7f5; --bg:#f4f7fb; --text:#0f172a; --muted:#5b6b7f;
      --card:#ffffff; --border:#d9e2ef; --radius:16px; --shadow:0 8px 30px rgba(0,51,102,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
                   Arial, "Noto Sans", "Liberation Sans", "Apple Color Emoji", "Segoe UI Emoji",
                   "Segoe UI Symbol", sans-serif;
      background:var(--bg); color:var(--text); line-height:1.6;
    }

    header{background:var(--brand); color:#fff; padding:20px 0; box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .brand-logo{display:block;margin:0 auto 16px;width:220px;max-width:80%;height:auto}
    header .wrap, main.wrap{width:75vw; max-width:none; margin:0 auto; padding:0 24px; display:block}
    main.wrap{padding:40px 24px}

    .hero-text{text-align:center}
    .hero-text h1{margin:0; font-size:36px; font-weight:700; letter-spacing:-.5px}
    .hero-text p{margin:4px 0 0; color:#dbeafe; font-size:20px; font-weight:500; text-align:center}

    .intro-box{
      margin-top:24px; background:rgba(255,255,255,.1); padding:16px 20px; border-radius:12px;
      border:1px solid rgba(255,255,255,.2); font-size:10px; line-height:1.6; width:100%; max-width:none
    }

    .grid{display:block}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:24px; margin-bottom:24px
    }
    .span-6,.span-12{display:block;width:100%}

    .row{display:block}
    .row>div{width:100%}
    .row>div+div{margin-top:12px}
    h2{color:var(--brand); margin-top:0; font-weight:700}
    label{font-weight:600; display:block; margin-top:14px}

    input,textarea,select{
      width:100%; padding:12px; border:1px solid var(--border); border-radius:12px;
      margin-top:6px; font-size:15px; background:#fff; min-height:44px; appearance:auto
    }
    textarea{min-height:96px}

    @media (max-width:640px){
      input,textarea,select,button{font-size:16px}
      .btns{justify-content:flex-start}
      header .wrap, main.wrap{width:94vw}
    }

    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    button{
      background:var(--brand); color:#fff; padding:10px 16px; border:0; border-radius:12px;
      font-weight:700; cursor:pointer; transition:.2s
    }
    button:hover{background:#00264d}
    button.ghost{background:transparent; color:var(--brand); border:1px solid var(--border)}
    .hint{color:var(--muted); font-size:12px}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:3px 8px; border-radius:999px;
           border:1px solid var(--border); font-size:12px; color:var(--muted)}

    .selector{display:block}
    .selected-list{
      display:block; padding:8px; border:1px dashed var(--border);
      border-radius:12px; background:#f7faff;
      /* important for touch dragging */
      touch-action:none;
    }

    /* Life Roles: title left, Remove right; textarea below; mobile-friendly drag */
    .role-item{
      display:grid;
      grid-template-columns: 1fr 44px; /* content + drag handle */
      grid-template-rows: auto auto;   /* header + textarea */
      gap:12px;
      padding:12px;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      user-select:none;
    }
    .role-name{
      grid-column:1 / 2;
      grid-row:1 / 2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border:1px solid var(--border);
      border-radius:10px;
      padding:12px;
      background:#fbfdff;
    }
    .role-name .title{font-weight:600; color:var(--brand); word-break:break-word}
    .role-name .actions .danger{
      background:#b91c1c; color:#fff; border:0; border-radius:10px; padding:8px 10px; font-weight:700
    }
/* Compact remove button on mobile */
.role-name .actions .remove-btn .btn-label { display:inline; }

@media (max-width:640px){
  .role-name .actions .remove-btn{
    background:transparent;
    color:#6b7280;           /* gray */
    border:1px solid #d1d5db;
    padding:0;
    width:28px; height:28px;
    border-radius:8px;
    display:inline-flex; align-items:center; justify-content:center;
    font-weight:700;
  }
  .role-name .actions .remove-btn .btn-label{ 
    /* hide the word "Remove" on mobile, keep for screen readers */
    position:absolute; width:1px; height:1px; padding:0; margin:-1px;
    overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
  }
  .role-name .actions .remove-btn::after{
    content:"×";
    font-size:18px;
    line-height:1;
  }
}
    .aff-box{
      grid-column:1 / 2;
      grid-row:2 / 3;
      display:flex;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff;
      overflow:auto;
    }
    .aff-box textarea{
      flex:1 1 auto;
      width:100%;
      min-height:120px;
      resize:vertical;
      border:0; outline:0; padding:12px;
      line-height:1.4; font-size:14px; text-align:left;
    }

    .drag{
      grid-column:2 / 3;
      grid-row:1 / 3;
      cursor:grab; display:flex; align-items:center; justify-content:center;
      border:1px dashed var(--border); border-radius:10px; background:#f9fbff; font-size:20px;
      touch-action:none; /* prevent scroll while dragging on touch */
    }
    .role-item.dragging{opacity:.9; outline:2px dashed var(--accent)}

    /* final section */
    .final-card{width:100%; margin:0}
    .final-card h3{margin:0 0 10px; font-size:22px; color:var(--brand); text-align:center}
    .output{
      white-space:pre-wrap; background:#f7faff; border:2px solid var(--accent); border-radius:14px;
      padding:24px; min-height:180px; font-size:18px; font-weight:500; color:var(--brand); line-height:1.85
    }

    footer{
      background:var(--brand); color:#fff; text-align:center; padding:24px; font-size:14px; margin-top:40px
    }
    .footer-social{
      display:flex; gap:14px; justify-content:center; align-items:center;
      margin:6px 0 10px 0;
    }
    .footer-social a{
      display:inline-flex; width:28px; height:28px; color:#ffffff; opacity:.9; transition:transform .15s ease, opacity .15s ease;
    }
    .footer-social a:hover{opacity:1; transform:translateY(-1px)}
    .footer-social svg{width:100%; height:100%; fill:currentColor}
  </style>

  <style media="print">
    @page{margin:20mm}
    body{background:#fff; color:#000; -webkit-print-color-adjust:exact; print-color-adjust:exact}
    header{display:none!important}
    footer{display:none!important}
    .grid > .card:not(.final-card){display:none!important}
    .btns{display:none!important}
    .card{box-shadow:none; border-color:#bbb}
    .print-header{
      display:block!important; background:linear-gradient(90deg,#003366,#2bb7f5); color:#fff;
      padding:18px 20px; border-radius:10px; margin-bottom:12px; font-size:18px
    }
    .output{background:#f7fbff; border:1px solid #2bb7f5; border-left:6px solid #2bb7f5}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="hero-text">
        <img
          src="https://www.xinnix.com/hubfs/XINNIX%20Logos/XINNIX_Logo_Full_white.svg"
          alt="XINNIX logo"
          class="brand-logo"
          loading="eager"
          decoding="async"
        />
        <h1>Mission Statement Builder</h1>
        <p>Create a focused, inspiring mission for the year — then align your roles and actions to fulfill it.</p>
        <div class="intro-box">
          <h2 style="color:#fff;margin:0 0 6px 0;font-weight:600;font-size:24px">Why You Need a Mission Statement</h2>
          <p style="margin:6px 0">Clarity creates momentum.</p>
          <p style="margin:6px 0">A personal mission gives you purpose, focus, and direction — so your daily choices match your values and goals.</p>
          <p style="margin:6px 0">It’s your compass and your fuel.</p>
          <p style="margin:6px 0">Read it daily to stay intentional, confident, and energized.</p>
          <p style="margin:6px 0">By the end, you’ll have a clear, powerful statement you can act on — starting now.</p>
          <p style="margin:6px 0 0 0">You are responsible. Your future is bright. Let’s go.</p>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <div class="card span-6">
        <h2>About You</h2>
        <div class="row">
          <div>
            <label for="yourName">Your Name</label>
            <input type="text" id="yourName" placeholder="e.g., Casey" />
          </div>
          <div>
            <label for="year">Focus Year</label>
            <input type="number" id="year" placeholder="2025" />
          </div>
        </div>
        <label for="values">Core Values (comma-separated)</label>
        <input type="text" id="values" placeholder="e.g., Courage, Excellence, Compassion" />
        <label for="themes">Big Themes for this Year</label>
        <input type="text" id="themes" placeholder="e.g., Health, Simplicity, Deep Work" />
        <label for="obg">One Big Goal (OBG)</label>
        <input type="text" id="obg" placeholder="e.g., Launch a new initiative in Q2" />
      </div>

      <div class="card span-6">
        <h2>People You Admire (Top 3)</h2>
        <p class="hint">List three people you admire and the specific characteristics you admire in them.</p>
        <div class="row">
          <div>
            <label for="p1">Person 1</label>
            <input id="p1" type="text" placeholder="Name" />
          </div>
          <div>
            <label for="t1">Characteristics</label>
            <input id="t1" type="text" placeholder="e.g., integrity, grit, curiosity" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="p2">Person 2</label>
            <input id="p2" type="text" placeholder="Name" />
          </div>
          <div>
            <label for="t2">Characteristics</label>
            <input id="t2" type="text" placeholder="e.g., service, courage, excellence" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="p3">Person 3</label>
            <input id="p3" type="text" placeholder="Name" />
          </div>
          <div>
            <label for="t3">Characteristics</label>
            <input id="t3" type="text" placeholder="e.g., wisdom, curiosity, resilience" />
          </div>
        </div>
      </div>

      <div class="card span-6">
        <h2>Life Roles — Pick 7, Prioritize, and Write 99-Year Affirmations</h2>
        <p class="hint">Select exactly seven roles from the dropdown, then drag to set priority. Each row has a 500-character box.</p>
        <div class="selector">
          <div class="row">
            <div>
              <label for="roleSelect">Choose a role to add</label>
              <select id="roleSelect">
                <option value="" selected disabled>— Select a role —</option>
                <option>Parent</option><option>Partner/Spouse</option><option>Friend</option><option>Leader</option>
                <option>CEO/Founder</option><option>Manager</option><option>Team Member</option><option>Teacher/Coach</option>
                <option>Student/Learner</option><option>Community Volunteer</option><option>Citizen/Advocate</option><option>Neighbor</option>
                <option>Mentor</option><option>Mentee</option><option>Health/Athlete</option><option>Spiritual/Faith</option>
                <option>Finances/Wealth Builder</option><option>Creator/Artist</option><option>Homemaker</option><option>Sibling</option>
                <option>Child</option><option>Grandparent</option><option>Entrepreneur</option><option>Investor</option>
                <option>Salesperson</option><option>Marketer</option><option>Writer</option><option>Speaker</option>
                <option>Engineer</option><option>Designer</option><option>Product Manager</option><option>Researcher</option>
                <option>Consultant</option><option>Board Member</option><option>Caregiver</option><option>Adventurer/Traveler</option>
                <option>Philanthropist</option><option>Organizer</option><option>Strategist</option><option>Operator</option>
                <option>Visionary</option><option>Connector</option><option>Host</option><option>Peacemaker</option>
                <option>Innovator</option><option>Lifelong Learner</option><option>Storyteller</option><option>Coach</option>
                <option>Protector</option><option>Servant Leader</option>
              </select>
            </div>
            <div style="align-self:end; display:flex; align-items:center; gap:10px;">
              <button id="addRole" type="button">Add Role</button>
              <span class="badge"><span id="roleCount">0</span>/7 selected</span>
              <span id="status" class="hint" aria-live="polite"></span>
            </div>
          </div>

          <label>Selected roles (drag to reorder priority)</label>
          <div id="selectedList" class="selected-list" aria-live="polite"></div>
        </div>
      </div>

      <div class="card span-6">
        <h2>Key Questions</h2>
        <label for="purpose">Why does your work (and life) matter?</label>
        <textarea id="purpose" placeholder="Because…"></textarea>
        <label for="strengths">What strengths will you lean on?</label>
        <textarea id="strengths" placeholder="e.g., resilience, storytelling, systems thinking"></textarea>
        <label for="fears">What fears/constraints will you face — and how will you respond?</label>
        <textarea id="fears" placeholder="Name the obstacle, name your response."></textarea>
        <label for="habits">Which 3–5 habits will you practice weekly?</label>
        <textarea id="habits" placeholder="e.g., 5 a.m. workout, deep work blocks, weekly review, connection calls"></textarea>
      </div>

      <div class="card span-12 final-card">
        <h3>Your Mission Statement</h3>
        <p class="hint" style="text-align:center;margin-top:-6px">Includes date written, a bold mission paragraph, your prioritized roles, and Affirmations @ 99.</p>
        <div id="printHeader" class="print-header" style="display:none;background:#003366;color:#fff;padding:16px 18px;border-radius:12px;text-align:center;font-weight:700;letter-spacing:.5px"></div>
        <div id="missionOutput" class="output"></div>
        <div class="btns" style="justify-content:center;">
          <button id="generate" type="button">Generate Mission</button>
          <button id="copy" type="button" class="ghost">Copy</button>
          <button id="downloadTxt" type="button" class="ghost">Download .txt</button>
          <button id="printPdf" type="button" class="ghost">Print / Save PDF</button>
          <button id="clearAll" type="button" class="ghost">Clear All</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-social" aria-label="XINNIX social links">
      <a href="https://www.facebook.com/XINNIXAcademy" aria-label="Facebook" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 264 512" aria-hidden="true"><path d="M76.7 512V283H0v-91h76.7v-71.7C76.7 42.4 124.3 0 193.8 0c33.3 0 61.9 2.5 70.2 3.6V85h-48.2c-37.8 0-45.1 18-45.1 44.3V192H256l-11.7 91h-73.6v229"></path></svg>
      </a>
      <a href="https://www.linkedin.com/company/xinnix" aria-label="LinkedIn" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-hidden="true"><path d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"></path></svg>
      </a>
      <a href="https://twitter.com/XINNIXAcademy" aria-label="Twitter" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-hidden="true"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
      </a>
      <a href="https://www.youtube.com/channel/UCcAJYno50GmPFU1UiTnIdTA?sub_confirmation=1" aria-label="YouTube" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-hidden="true"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
      </a>
      <a href="https://www.instagram.com/xinnixtraining/" aria-label="Instagram" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-hidden="true"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
      </a>
    </div>
    © 2025 XINNIX, Inc. All rights reserved. Empowering leaders to transform their purpose into action.
  </footer>

  <script>
    function $(q,el){el=el||document;return el.querySelector(q)}
    function createEl(tag,attrs={},children=[]){
      var el=document.createElement(tag);
      for(var k in attrs){if(!Object.prototype.hasOwnProperty.call(attrs,k))continue;
        var v=attrs[k]; if(k==='class')el.className=v; else if(k==='text')el.textContent=v; else if(k==='html')el.innerHTML=v; else el.setAttribute(k,v);
      }
      for(var i=0;i<children.length;i++)el.appendChild(children[i]); return el;
    }
    function uid(){return Math.random().toString(36).slice(2,9)}
    function notify(msg,isErr){const s=$("#status"); if(!s){(console[isErr?'warn':'log']||console.log)(msg); return;} s.textContent=msg; s.style.color=isErr?'#b91c1c':'#0f766e'; clearTimeout(notify._t); notify._t=setTimeout(()=>s.textContent='',3000)}

    var ROLES=['Parent','Partner/Spouse','Friend','Leader','CEO/Founder','Manager','Team Member','Teacher/Coach','Student/Learner','Community Volunteer','Citizen/Advocate','Neighbor','Mentor','Mentee','Health/Athlete','Spiritual/Faith','Finances/Wealth Builder','Creator/Artist','Homemaker','Sibling','Child','Grandparent','Entrepreneur','Investor','Salesperson','Marketer','Writer','Speaker','Engineer','Designer','Product Manager','Researcher','Consultant','Board Member','Caregiver','Adventurer/Traveler','Philanthropist','Organizer','Strategist','Operator','Visionary','Connector','Host','Peacemaker','Innovator','Lifelong Learner','Storyteller','Coach','Protector','Servant Leader'];
    ROLES.sort((a,b)=>a.localeCompare(b,undefined,{sensitivity:'base'}));

    (function populateRoles(){
      var rs=document.getElementById('roleSelect'); if(!rs) return;
      if(rs.options.length<=1){ ROLES.forEach(r=> rs.appendChild(new Option(r,r)))}
    })();

    (function alphabetizeRoleSelect(){
      var sel = document.getElementById('roleSelect'); if(!sel) return;
      var first = sel.querySelector('option[disabled]');
      var opts = Array.from(sel.querySelectorAll('option')).filter(o=>o!==first);
      opts.sort((a,b)=>a.textContent.localeCompare(b.textContent,undefined,{sensitivity:'base'}));
      opts.forEach(o=>o.remove());
      opts.forEach(o=>sel.appendChild(o));
    })();

    function audienceForRole(name){
      var n=String(name||'').toLowerCase();
      var map=[
        [/^parent$/,'your children'],[/^(partner|spouse)$/,'your spouse/partner'],[/^friend$/,'your closest friends'],
        [/^leader$/,'your team'],[/^ceo|founder$/,'your company'],[/^manager$/,'your team'],[/^team member$/,'your teammates'],
        [/^teacher|coach$/,'your students/coachees'],[/^student|learner$/,'your mentors'],[/^community volunteer$/,'your community'],
        [/^citizen|advocate$/,'your community'],[/^neighbor$/,'your neighbors'],[/^mentor$/,'your mentees'],[/^mentee$/,'your mentors'],
        [/^health|athlete$/,'your future self'],[/^spiritual|faith$/,'those you worship with'],[/^finances|wealth/,'your future family'],
        [/^creator|artist$/,'your audience'],[/^homemaker$/,'your family'],[/^sibling$/,'your siblings'],[/^child$/,'your parent(s)'],
        [/^grandparent$/,'your grandchildren'],[/^entrepreneur$/,'your customers and team'],[/^investor$/,'your partners'],
        [/^salesperson$/,'your clients'],[/^marketer$/,'your market'],[/^writer$/,'your readers'],[/^speaker$/,'your audience'],
        [/^engineer$/,'the people who use your products'],[/^designer$/,'the people who experience your work'],
        [/^product manager$/,'your product team and users'],[/^researcher$/,'your field and peers'],[/^consultant$/,'your clients'],
        [/^board member$/,'your stakeholders'],[/^caregiver$/,'those you care for'],[/^(adventurer|traveler)$/,'your travel companions and future self'],
        [/^philanthropist$/,'the people you serve'],[/^organizer$/,'your community'],[/^strategist$/,'your leadership peers'],
        [/^operator$/,'your organization'],[/^visionary$/,'those you inspire'],[/^connector$/,'your network'],[/^host$/,'your guests'],
        [/^peacemaker$/,'those you reconcile'],[/^innovator$/,'your industry'],[/^lifelong learner$/,'your future self'],
        [/^storyteller$/,'your audience'],[/^coach$/,'your athletes/clients'],[/^protector$/,'those you protect'],[/^servant leader$/,'the people you serve']
      ];
      for(var i=0;i<map.length;i++){ if(map[i][0].test(n)) return map[i][1]; }
      return 'the people you serve';
    }

    var selected=[]; // {id,name}
    var selectedList=document.getElementById('selectedList');
    var roleCount=document.getElementById('roleCount');
    function updateRoleCount(){ if(roleCount) roleCount.textContent=selected.length; }

    function removeRole(id){
      var idx=selected.findIndex(r=>r.id===id); if(idx>=0) selected.splice(idx,1);
      var item=selectedList.querySelector('.role-item[data-id="'+id+'"]'); if(item) item.remove();
      updateRoleCount(); saveState();
    }

    function roleItem(role){
      var item=createEl('div',{class:'role-item','data-id':role.id}); // no HTML5 draggable

      var header=createEl('div',{class:'role-name'});
      header.appendChild(createEl('div',{class:'title',text:role.name}));
      var actions=createEl('div',{class:'actions'});
      var rm=createEl('button',{class:'danger',text:'Remove',type:'button'});
      rm.addEventListener('click',()=>removeRole(role.id));
      actions.appendChild(rm);
      header.appendChild(actions);

      var body=createEl('div',{class:'aff-box'});
      var ta=createEl('textarea',{
        id:`aff_${role.id}`, maxlength:'500',
        placeholder:`What would you want ${audienceForRole(role.name)} to say about you at 99?`,
        'aria-label':`${role.name} affirmation (max 500 characters)`
      });
      body.appendChild(ta);

      var handle=createEl('div',{class:'drag',text:'⋮⋮'});

      item.appendChild(header);
      item.appendChild(body);
      item.appendChild(handle);

      ta.addEventListener('input',()=>saveState());
      return item;
    }

    var roleSelect=document.getElementById('roleSelect');
    document.getElementById('addRole').addEventListener('click',function(e){
      e.preventDefault();
      if(selected.length>=7){ notify('You already have 7 roles.',true); return; }
      var name=roleSelect.value; if(!name){ notify('Choose a role first.',true); roleSelect.focus(); return; }
      if(selected.some(r=>r.name===name)){ notify('Role already added.',true); return; }
      var role={id:uid(),name}; selected.push(role); selectedList.appendChild(roleItem(role));
      updateRoleCount(); roleSelect.selectedIndex=0; saveState();
    });

    /* --- Pointer-based drag & drop (touch + mouse) --- */
    let dragEl=null, dragId=null;
    function getAfterElement(container,y){
      const els=[...container.querySelectorAll('.role-item:not(.dragging)')];
      let closest=null, closestOffset=-Infinity;
      for(const el of els){
        const box=el.getBoundingClientRect();
        const offset=y - (box.top + box.height/2);
        if(offset<0 && offset>closestOffset){ closestOffset=offset; closest=el; }
      }
      return closest;
    }

    selectedList.addEventListener('pointerdown', (e)=>{
      const item=e.target.closest('.role-item');
      if(!item) return;
      // Only start drag if the drag handle or header is touched (avoid textarea grabs)
      if(!e.target.closest('.drag') && !e.target.closest('.role-name')) return;
      dragEl=item; dragId=e.pointerId;
      item.classList.add('dragging');
      try{ item.setPointerCapture(dragId); }catch(_){}
      if(e.pointerType==='touch') e.preventDefault();
    }, {passive:false});

    selectedList.addEventListener('pointermove', (e)=>{
      if(!dragEl) return;
      if(e.pointerType==='touch') e.preventDefault();
      const after=getAfterElement(selectedList, e.clientY);
      if(after==null){ selectedList.appendChild(dragEl); }
      else{ selectedList.insertBefore(dragEl, after); }
    }, {passive:false});

    function endPointerDrag(){
      if(!dragEl) return;
      try{ dragEl.releasePointerCapture(dragId); }catch(_){}
      dragEl.classList.remove('dragging');
      dragEl=null; dragId=null;
      saveState();
    }
    selectedList.addEventListener('pointerup',   (e)=>{ if(e.pointerType==='touch') e.preventDefault(); endPointerDrag(); }, {passive:false});
    selectedList.addEventListener('pointercancel', endPointerDrag);

    /* compose output */
    function orderedRoles(){
      return [...selectedList.querySelectorAll('.role-item')].map(el=>{
        const id=el.getAttribute('data-id');
        const f=selected.find(r=>r.id===id);
        return f?f.name:'';
      }).filter(Boolean);
    }
    function collectAffs(){
      const map={};
      selected.forEach(r=>{
        var el=document.getElementById('aff_'+r.id);
        map[r.name]=el?(el.value||'').trim():'';
      });
      return map;
    }

    function composeMissionText({name,year,values,themes,obg,purpose,strengths,fears,habits,traits,roles,affs,date}){
      const clean=s=>(s&&s.trim())?s.trim():'—';
      const uniqTraits=Array.from(new Set((traits||[]).filter(Boolean)));
      const topTraits=uniqTraits.slice(0,6);
      const s1=`${name?name.toUpperCase()+': ':''}I am on a mission${year?` in ${year}`:''} to bring ${clean(obg)==='—'?'my boldest vision':clean(obg)} to life — with relentless energy, fierce focus, and a bias for action.`;
      const s1b=`Rooted in my core values — ${clean(values)} — and guided by this year’s themes — ${clean(themes)} — I will decide, act, and lead with courage every single day.`;
      const s2=`I will embody what I admire most — ${topTraits.length?topTraits.join(', '):'character, courage, and excellence'} — and multiply my unique strengths (${clean(strengths)}) to advance a purpose that truly matters: ${clean(purpose)}.`;
      const s3=`When resistance shows up (${clean(fears)}), I will answer with disciplined habits (${clean(habits)}) that compound — building momentum week after week.`;
      const s4=`I will live out my priorities through these seven important roles:`;
      const dateStr=(date||new Date()).toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
      const affBlock=(roles||[]).map((r,i)=>`${i+1}. ${r}: ${(affs&&affs[r])||''}`).join('\n');
      return [`Date Written: ${dateStr}`,'',s1,'',s1b,'',s2,'',s3,'',s4,'',affBlock].join('\n');
    }

    document.getElementById('generate').addEventListener('click',function(){
      const roles=orderedRoles();
      if(roles.length!==7){ notify('Select exactly 7 roles.',true); return; }
      const name=$('#yourName').value.trim();
      const year=$('#year').value.trim();
      const values=$('#values').value.trim();
      const themes=$('#themes').value.trim();
      const obg=$('#obg').value.trim();
      const purpose=$('#purpose').value.trim();
      const strengths=$('#strengths').value.trim();
      const fears=$('#fears').value.trim();
      const habits=$('#habits').value.trim();
      const affs=collectAffs();
      const full=composeMissionText({name,year,values,themes,obg,purpose,strengths,fears,habits,traits:[],roles,affs});
      $('#missionOutput').textContent=full;

      const header = name?`${name.toUpperCase()} — MISSION STATEMENT`:'MISSION STATEMENT';
      const ph=document.getElementById('printHeader'); if(ph) ph.textContent=`XINNIX • ${header}`;
      notify('Mission generated.');
      saveState();
    });

    /* clipboard */
    function legacyCopy(text){
      const ta=document.createElement('textarea');
      ta.value=text; ta.setAttribute('readonly',''); ta.style.position='fixed'; ta.style.top='-9999px';
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); notify('Copied.'); }catch(e){ notify('Copy failed.',true); }
      document.body.removeChild(ta);
    }
    function copyMission(){
      const t=$('#missionOutput').textContent.trim(); if(!t){ notify('Nothing to copy.',true); return; }
      if(window.isSecureContext && navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(t).then(()=>notify('Copied.'),()=>legacyCopy(t));
      } else { legacyCopy(t); }
    }
    document.getElementById('copy').addEventListener('click', copyMission);

    /* download .txt */
    document.getElementById('downloadTxt').addEventListener('click', ()=>{
      const t=$('#missionOutput').textContent.trim(); if(!t){ notify('Generate first.',true); return; }
      const a=document.createElement('a');
      a.href='data:text/plain;charset=utf-8,'+encodeURIComponent(t);
      a.download='mission-statement.txt';
      document.body.appendChild(a); a.click(); a.remove();
    });

    /* print */
    document.getElementById('printPdf').addEventListener('click',()=>window.print());

    /* CLEAR ALL */
    function resetAll(){
      ['yourName','year','values','themes','obg','purpose','strengths','fears','habits'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.value='';
      });
      const y=document.getElementById('year'); if(y) y.value=new Date().getFullYear();
      selected.splice(0, selected.length);
      selectedList.innerHTML='';
      if (roleCount) roleCount.textContent='0';
      const mo=document.getElementById('missionOutput'); if(mo) mo.textContent='';
      const sEl=document.getElementById('status'); if(sEl) sEl.textContent='';
      try{ localStorage.removeItem('msb_state_v1'); }catch(e){}
      notify('All fields cleared.');
    }
    document.getElementById('clearAll').addEventListener('click', resetAll);

    /* persistence */
    var STORAGE_KEY='msb_state_v1';
    function currentState(){
      return {
        name:$('#yourName').value||'', year:$('#year').value||'', values:$('#values').value||'',
        themes:$('#themes').value||'', obg:$('#obg').value||'', purpose:$('#purpose').value||'',
        strengths:$('#strengths').value||'', fears:$('#fears').value||'', habits:$('#habits').value||'',
        roles:orderedRoles(), affs:collectAffs(), mission:$('#missionOutput').textContent||''
      };
    }
    function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(currentState())); }catch(e){} }
    function loadState(){
      const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return;
      try{ applyState(JSON.parse(raw)); }catch(e){}
    }
    function applyState(s){
      if(!s||typeof s!=='object') return;
      $('#yourName').value=s.name||''; $('#year').value=s.year||new Date().getFullYear();
      $('#values').value=s.values||''; $('#themes').value=s.themes||''; $('#obg').value=s.obg||'';
      $('#purpose').value=s.purpose||''; $('#strengths').value=s.strengths||'';
      $('#fears').value=s.fears||''; $('#habits').value=s.habits||'';
      selected.splice(0,selected.length); selectedList.innerHTML='';
      if(Array.isArray(s.roles)){
        s.roles.forEach(name=>{
          const role={id:uid(),name}; selected.push(role);
          const el=roleItem(role); selectedList.appendChild(el);
          if(s.affs && typeof s.affs[name]==='string'){
            const ta=el.querySelector('#aff_'+role.id); if(ta) ta.value=s.affs[name];
          }
        });
        updateRoleCount();
      }
      $('#missionOutput').textContent=s.mission||'';
    }

    function debounce(fn,ms){ms=(ms==null)?400:ms;var t;return function(){clearTimeout(t);var args=arguments;t=setTimeout(function(){fn.apply(null,args)},ms)}}
    var autosave=debounce(()=>saveState(),600);
    document.addEventListener('input',e=>{var t=e.target;if(t && (t.matches? t.matches('input, textarea, select'):/^(INPUT|TEXTAREA|SELECT)$/.test(t.tagName))) autosave();});
    document.addEventListener('change',e=>{var t=e.target;if(t && (t.matches? t.matches('input, textarea, select'):/^(INPUT|TEXTAREA|SELECT)$/.test(t.tagName))) autosave();});

    document.getElementById('year').value=new Date().getFullYear();
    loadState();
  </script>
</body>
</html>

